{% extends "index.html" %}
{% load static %}

{% block content %}
<header>
  {% include 'common/navbar.html' %}
</header>

<main class="container mt-5">
  {% block main_content %}
  
  <!-- Encabezado de categoría -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">Categoría {{ current_category }}</h3>
    <form method="get" action="{% url 'votaciones' %}">
      <input type="hidden" name="categoria" value="{{ next_category }}">
      <button type="submit" class="btn btn-dark">
        <strong>&gt;</strong>
      </button>
    </form>
  </div>

  <!-- Tarjetas -->
  <div class="py-5">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3">
      {% for student in students %}
        <div class="col">
          {% include 'common/vote.html' %}
        </div>
      {% empty %}
        <div class="card text-center w-100 py-3">
          <div class="card-header py-3">
            Sin resultados
          </div>
          <div class="card-body py-5">
            <h5 class="card-title">No se han encontrado estudiantes</h5>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  {% endblock %}
  {% regroup ranking by category__name as votos_por_categoria %}

  {% for categoria in votos_por_categoria %}
    <h2>{{ categoria.grouper }}</h2>
    <ul>
      {% for voto in categoria.list %}
        <li>{{ voto.voted_user__first_name }} {{ voto.voted_user__last_name }}: {{ voto.total }} votos</li>
      {% endfor %}
    </ul>
  {% endfor %}
  
</main>
{% endblock %}
